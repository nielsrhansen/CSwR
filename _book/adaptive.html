<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Computational Statistics with R</title>
  <meta name="description" content="Lecture notes providing an introduction to computational statistics using the R programming language.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Computational Statistics with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Computational Statistics with R" />
  
  <meta name="twitter:description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  

<meta name="author" content="Niels Richard Hansen">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="reject-samp.html">
<link rel="next" href="exercises-2.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro-smooth.html"><a href="intro-smooth.html"><i class="fa fa-check"></i><b>1.1</b> Smoothing</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro-smooth.html"><a href="intro-smooth.html#intro-angles"><i class="fa fa-check"></i><b>1.1.1</b> Angle distributions in proteins</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro-smooth.html"><a href="intro-smooth.html#using-ggplot2"><i class="fa fa-check"></i><b>1.1.2</b> Using ggplot2</a></li>
<li class="chapter" data-level="1.1.3" data-path="intro-smooth.html"><a href="intro-smooth.html#changing-the-defaults"><i class="fa fa-check"></i><b>1.1.3</b> Changing the defaults</a></li>
<li class="chapter" data-level="1.1.4" data-path="intro-smooth.html"><a href="intro-smooth.html#large-scale-smoothing"><i class="fa fa-check"></i><b>1.1.4</b> Large scale smoothing</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html"><i class="fa fa-check"></i><b>1.2</b> Monte Carlo Methods</a><ul>
<li class="chapter" data-level="1.2.1" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#vM"><i class="fa fa-check"></i><b>1.2.1</b> Univariate von Mises distributions</a></li>
<li class="chapter" data-level="1.2.2" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#mixtures-of-von-mises-distributions"><i class="fa fa-check"></i><b>1.2.2</b> Mixtures of von Mises distributions</a></li>
<li class="chapter" data-level="1.2.3" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#large-scale-simulation"><i class="fa fa-check"></i><b>1.2.3</b> Large scale simulation</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>1.3</b> Optimization</a><ul>
<li class="chapter" data-level="1.3.1" data-path="optimization.html"><a href="optimization.html#the-em-algorithm"><i class="fa fa-check"></i><b>1.3.1</b> The EM-algorithm</a></li>
<li class="chapter" data-level="1.3.2" data-path="optimization.html"><a href="optimization.html#large-scale-optimization"><i class="fa fa-check"></i><b>1.3.2</b> Large scale optimization</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.4</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html#r-training-exercises"><i class="fa fa-check"></i>R training exercises</a></li>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html#histograms-with-non-equidistant-breaks"><i class="fa fa-check"></i>Histograms with non-equidistant breaks</a></li>
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html#functions-and-functional-programming"><i class="fa fa-check"></i>Functions and functional programming</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part I: Smoothing</b></span></li>
<li class="chapter" data-level="2" data-path="density.html"><a href="density.html"><i class="fa fa-check"></i><b>2</b> Density estimation</a><ul>
<li class="chapter" data-level="2.1" data-path="unidens.html"><a href="unidens.html"><i class="fa fa-check"></i><b>2.1</b> Univariate density estimation</a><ul>
<li class="chapter" data-level="2.1.1" data-path="unidens.html"><a href="unidens.html#likelihood"><i class="fa fa-check"></i><b>2.1.1</b> Likelihood considerations</a></li>
<li class="chapter" data-level="2.1.2" data-path="unidens.html"><a href="unidens.html#sieves"><i class="fa fa-check"></i><b>2.1.2</b> Method of sieves</a></li>
<li class="chapter" data-level="2.1.3" data-path="unidens.html"><a href="unidens.html#basis-density"><i class="fa fa-check"></i><b>2.1.3</b> Basis expansions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="kernel-density.html"><a href="kernel-density.html"><i class="fa fa-check"></i><b>2.2</b> Kernel methods</a><ul>
<li class="chapter" data-level="2.2.1" data-path="kernel-density.html"><a href="kernel-density.html#implementation"><i class="fa fa-check"></i><b>2.2.1</b> Implementation</a></li>
<li class="chapter" data-level="2.2.2" data-path="kernel-density.html"><a href="kernel-density.html#benchmarking"><i class="fa fa-check"></i><b>2.2.2</b> Benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bandwidth.html"><a href="bandwidth.html"><i class="fa fa-check"></i><b>2.3</b> Bandwidth selection</a><ul>
<li class="chapter" data-level="2.3.1" data-path="bandwidth.html"><a href="bandwidth.html#rectangular"><i class="fa fa-check"></i><b>2.3.1</b> Revisiting the rectangular kernel</a></li>
<li class="chapter" data-level="2.3.2" data-path="bandwidth.html"><a href="bandwidth.html#ise-mise-and-mse-for-kernel-estimators"><i class="fa fa-check"></i><b>2.3.2</b> ISE, MISE and MSE for kernel estimators</a></li>
<li class="chapter" data-level="2.3.3" data-path="bandwidth.html"><a href="bandwidth.html#plug-in-estimation-of-the-oracle-bandwidth"><i class="fa fa-check"></i><b>2.3.3</b> Plug-in estimation of the oracle bandwidth</a></li>
<li class="chapter" data-level="2.3.4" data-path="bandwidth.html"><a href="bandwidth.html#cross-validation"><i class="fa fa-check"></i><b>2.3.4</b> Cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="multivariate-smoothing.html"><a href="multivariate-smoothing.html"><i class="fa fa-check"></i><b>2.4</b> Multivariate methods</a></li>
<li class="chapter" data-level="2.5" data-path="exercises-1.html"><a href="exercises-1.html"><i class="fa fa-check"></i><b>2.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="exercises-1.html"><a href="exercises-1.html#kernel-density-estimation"><i class="fa fa-check"></i>Kernel density estimation</a></li>
<li class="chapter" data-level="" data-path="exercises-1.html"><a href="exercises-1.html#benchmarking-1"><i class="fa fa-check"></i>Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bivariate.html"><a href="bivariate.html"><i class="fa fa-check"></i><b>3</b> Bivariate smoothing</a><ul>
<li class="chapter" data-level="3.1" data-path="nearest-neighbor-smoothers.html"><a href="nearest-neighbor-smoothers.html"><i class="fa fa-check"></i><b>3.1</b> Nearest neighbor smoothers</a><ul>
<li class="chapter" data-level="3.1.1" data-path="nearest-neighbor-smoothers.html"><a href="nearest-neighbor-smoothers.html#linear-smoothers"><i class="fa fa-check"></i><b>3.1.1</b> Linear smoothers</a></li>
<li class="chapter" data-level="3.1.2" data-path="nearest-neighbor-smoothers.html"><a href="nearest-neighbor-smoothers.html#implementing-the-running-mean"><i class="fa fa-check"></i><b>3.1.2</b> Implementing the running mean</a></li>
<li class="chapter" data-level="3.1.3" data-path="nearest-neighbor-smoothers.html"><a href="nearest-neighbor-smoothers.html#choose-k-by-cross-validation"><i class="fa fa-check"></i><b>3.1.3</b> Choose <span class="math inline">\(k\)</span> by cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="kernel-methods.html"><a href="kernel-methods.html"><i class="fa fa-check"></i><b>3.2</b> Kernel methods</a></li>
<li class="chapter" data-level="3.3" data-path="sparse-linear-algebra.html"><a href="sparse-linear-algebra.html"><i class="fa fa-check"></i><b>3.3</b> Sparse linear algebra</a></li>
<li class="chapter" data-level="3.4" data-path="onb.html"><a href="onb.html"><i class="fa fa-check"></i><b>3.4</b> Orthogonal basis expansions</a><ul>
<li class="chapter" data-level="3.4.1" data-path="onb.html"><a href="onb.html#polynomial-expansions"><i class="fa fa-check"></i><b>3.4.1</b> Polynomial expansions</a></li>
<li class="chapter" data-level="3.4.2" data-path="onb.html"><a href="onb.html#fourier-expansions"><i class="fa fa-check"></i><b>3.4.2</b> Fourier expansions</a></li>
<li class="chapter" data-level="3.4.3" data-path="onb.html"><a href="onb.html#wavelets"><i class="fa fa-check"></i><b>3.4.3</b> Wavelets</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="splines.html"><a href="splines.html"><i class="fa fa-check"></i><b>3.5</b> Splines</a><ul>
<li class="chapter" data-level="3.5.1" data-path="splines.html"><a href="splines.html#smoothing-splines"><i class="fa fa-check"></i><b>3.5.1</b> Smoothing splines</a></li>
<li class="chapter" data-level="3.5.2" data-path="splines.html"><a href="splines.html#splines-in-r"><i class="fa fa-check"></i><b>3.5.2</b> Splines in R</a></li>
<li class="chapter" data-level="3.5.3" data-path="splines.html"><a href="splines.html#efficient-computation-with-splines"><i class="fa fa-check"></i><b>3.5.3</b> Efficient computation with splines</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="gaussian-processes.html"><a href="gaussian-processes.html"><i class="fa fa-check"></i><b>3.6</b> Gaussian processes</a></li>
<li class="chapter" data-level="3.7" data-path="the-kalman-filter.html"><a href="the-kalman-filter.html"><i class="fa fa-check"></i><b>3.7</b> The Kalman filter</a><ul>
<li class="chapter" data-level="3.7.1" data-path="the-kalman-filter.html"><a href="the-kalman-filter.html#ar1-example"><i class="fa fa-check"></i><b>3.7.1</b> AR(1)-example</a></li>
<li class="chapter" data-level="3.7.2" data-path="the-kalman-filter.html"><a href="the-kalman-filter.html#the-kalman-smoother"><i class="fa fa-check"></i><b>3.7.2</b> The Kalman smoother</a></li>
<li class="chapter" data-level="3.7.3" data-path="the-kalman-filter.html"><a href="the-kalman-filter.html#implementation-1"><i class="fa fa-check"></i><b>3.7.3</b> Implementation</a></li>
<li class="chapter" data-level="3.7.4" data-path="the-kalman-filter.html"><a href="the-kalman-filter.html#the-kalman-filter-1"><i class="fa fa-check"></i><b>3.7.4</b> The Kalman filter</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part II: Monte Carlo Methods</b></span></li>
<li class="chapter" data-level="4" data-path="univariate-random-variables.html"><a href="univariate-random-variables.html"><i class="fa fa-check"></i><b>4</b> Univariate random variables</a><ul>
<li class="chapter" data-level="4.1" data-path="pseudo-random-numbers.html"><a href="pseudo-random-numbers.html"><i class="fa fa-check"></i><b>4.1</b> Pseudo random numbers</a></li>
<li class="chapter" data-level="4.2" data-path="transformation-techniques.html"><a href="transformation-techniques.html"><i class="fa fa-check"></i><b>4.2</b> Transformation techniques</a><ul>
<li class="chapter" data-level="4.2.1" data-path="transformation-techniques.html"><a href="transformation-techniques.html#sampling-from-a-t-distribution"><i class="fa fa-check"></i><b>4.2.1</b> Sampling from a <span class="math inline">\(t\)</span>-distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="reject-samp.html"><a href="reject-samp.html"><i class="fa fa-check"></i><b>4.3</b> Rejection sampling</a><ul>
<li class="chapter" data-level="4.3.1" data-path="reject-samp.html"><a href="reject-samp.html#vMsim"><i class="fa fa-check"></i><b>4.3.1</b> von Mises distribution</a></li>
<li class="chapter" data-level="4.3.2" data-path="reject-samp.html"><a href="reject-samp.html#gamma-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Gamma distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="adaptive.html"><a href="adaptive.html"><i class="fa fa-check"></i><b>4.4</b> Adaptive envelopes</a><ul>
<li class="chapter" data-level="4.4.1" data-path="adaptive.html"><a href="adaptive.html#beta-distribution"><i class="fa fa-check"></i><b>4.4.1</b> Beta distribution</a></li>
<li class="chapter" data-level="4.4.2" data-path="adaptive.html"><a href="adaptive.html#von-mises-distribution"><i class="fa fa-check"></i><b>4.4.2</b> von Mises distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="exercises-2.html"><a href="exercises-2.html"><i class="fa fa-check"></i><b>4.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="exercises-2.html"><a href="exercises-2.html#rejection-sampling-of-gaussian-random-variables"><i class="fa fa-check"></i>Rejection sampling of Gaussian random variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="MCI.html"><a href="MCI.html"><i class="fa fa-check"></i><b>5</b> Monte Carlo integration</a><ul>
<li class="chapter" data-level="5.1" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i><b>5.1</b> Assessment</a><ul>
<li class="chapter" data-level="5.1.1" data-path="assessment.html"><a href="assessment.html#using-the-central-limit-theorem"><i class="fa fa-check"></i><b>5.1.1</b> Using the central limit theorem</a></li>
<li class="chapter" data-level="5.1.2" data-path="assessment.html"><a href="assessment.html#concentration-inequalities"><i class="fa fa-check"></i><b>5.1.2</b> Concentration inequalities</a></li>
<li class="chapter" data-level="5.1.3" data-path="assessment.html"><a href="assessment.html#exponential-tail-bound-for-gamma-distributed-variables"><i class="fa fa-check"></i><b>5.1.3</b> Exponential tail bound for Gamma distributed variables</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="importance-sampling.html"><a href="importance-sampling.html"><i class="fa fa-check"></i><b>5.2</b> Importance sampling</a><ul>
<li class="chapter" data-level="5.2.1" data-path="importance-sampling.html"><a href="importance-sampling.html#unknown-normalization-constants"><i class="fa fa-check"></i><b>5.2.1</b> Unknown normalization constants</a></li>
<li class="chapter" data-level="5.2.2" data-path="importance-sampling.html"><a href="importance-sampling.html#computing-a-high-dimensional-integral"><i class="fa fa-check"></i><b>5.2.2</b> Computing a high-dimensional integral</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="network-failure.html"><a href="network-failure.html"><i class="fa fa-check"></i><b>5.3</b> Network failure</a><ul>
<li class="chapter" data-level="5.3.1" data-path="network-failure.html"><a href="network-failure.html#object-oriented-implementation"><i class="fa fa-check"></i><b>5.3.1</b> Object oriented implementation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="design-of-experiments.html"><a href="design-of-experiments.html"><i class="fa fa-check"></i><b>5.4</b> Design of experiments</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multivariate-random-variables.html"><a href="multivariate-random-variables.html"><i class="fa fa-check"></i><b>6</b> Multivariate random variables</a><ul>
<li class="chapter" data-level="6.1" data-path="sequential-simulation.html"><a href="sequential-simulation.html"><i class="fa fa-check"></i><b>6.1</b> Sequential simulation</a><ul>
<li class="chapter" data-level="6.1.1" data-path="sequential-simulation.html"><a href="sequential-simulation.html#sequential-mc-for-the-ar1-process"><i class="fa fa-check"></i><b>6.1.1</b> Sequential MC for the AR(1)-process</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="gaussian-random-variables.html"><a href="gaussian-random-variables.html"><i class="fa fa-check"></i><b>6.2</b> Gaussian random variables</a></li>
</ul></li>
<li class="part"><span><b>Part III: Optimization</b></span></li>
<li class="chapter" data-level="7" data-path="four-examples.html"><a href="four-examples.html"><i class="fa fa-check"></i><b>7</b> Four Examples</a><ul>
<li class="chapter" data-level="7.1" data-path="multinomial-models.html"><a href="multinomial-models.html"><i class="fa fa-check"></i><b>7.1</b> Multinomial models</a><ul>
<li class="chapter" data-level="7.1.1" data-path="multinomial-models.html"><a href="multinomial-models.html#peppered-moths"><i class="fa fa-check"></i><b>7.1.1</b> Peppered Moths</a></li>
<li class="chapter" data-level="7.1.2" data-path="multinomial-models.html"><a href="multinomial-models.html#multinomial-cell-collapsing"><i class="fa fa-check"></i><b>7.1.2</b> Multinomial cell collapsing</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="mixtures.html"><a href="mixtures.html"><i class="fa fa-check"></i><b>7.2</b> Mixtures</a><ul>
<li class="chapter" data-level="7.2.1" data-path="mixtures.html"><a href="mixtures.html#gaussian-mixtures"><i class="fa fa-check"></i><b>7.2.1</b> Gaussian mixtures</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="mixed-effects-models.html"><a href="mixed-effects-models.html"><i class="fa fa-check"></i><b>7.3</b> Mixed effects models</a></li>
<li class="chapter" data-level="7.4" data-path="gaussian-state-space-models.html"><a href="gaussian-state-space-models.html"><i class="fa fa-check"></i><b>7.4</b> Gaussian state space models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="numerical-optimization.html"><a href="numerical-optimization.html"><i class="fa fa-check"></i><b>8</b> Numerical optimization</a><ul>
<li class="chapter" data-level="8.1" data-path="gradient-based-algorithms.html"><a href="gradient-based-algorithms.html"><i class="fa fa-check"></i><b>8.1</b> Gradient based algorithms</a><ul>
<li class="chapter" data-level="8.1.1" data-path="gradient-based-algorithms.html"><a href="gradient-based-algorithms.html#gradient-descent-and-conjugate-gradient"><i class="fa fa-check"></i><b>8.1.1</b> Gradient descent and conjugate gradient</a></li>
<li class="chapter" data-level="8.1.2" data-path="gradient-based-algorithms.html"><a href="gradient-based-algorithms.html#peppered-moths-1"><i class="fa fa-check"></i><b>8.1.2</b> Peppered Moths</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="newton-type-algorithms.html"><a href="newton-type-algorithms.html"><i class="fa fa-check"></i><b>8.2</b> Newton-type algorithms</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="EM.html"><a href="EM.html"><i class="fa fa-check"></i><b>9</b> Expectation Maximization algorithms</a><ul>
<li class="chapter" data-level="9.1" data-path="basic-properties.html"><a href="basic-properties.html"><i class="fa fa-check"></i><b>9.1</b> Basic properties</a><ul>
<li class="chapter" data-level="9.1.1" data-path="basic-properties.html"><a href="basic-properties.html#incomplete-data-likelihood"><i class="fa fa-check"></i><b>9.1.1</b> Incomplete data likelihood</a></li>
<li class="chapter" data-level="9.1.2" data-path="basic-properties.html"><a href="basic-properties.html#the-em-algorithm-is-ascending"><i class="fa fa-check"></i><b>9.1.2</b> The EM-algorithm is ascending</a></li>
<li class="chapter" data-level="9.1.3" data-path="basic-properties.html"><a href="basic-properties.html#multinomial-cell-collapsing-1"><i class="fa fa-check"></i><b>9.1.3</b> Multinomial cell collapsing</a></li>
<li class="chapter" data-level="9.1.4" data-path="basic-properties.html"><a href="basic-properties.html#peppered-moths-e--and-m-steps"><i class="fa fa-check"></i><b>9.1.4</b> Peppered Moths E- and M-steps</a></li>
<li class="chapter" data-level="9.1.5" data-path="basic-properties.html"><a href="basic-properties.html#inside-the-em"><i class="fa fa-check"></i><b>9.1.5</b> Inside the EM</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="EM-exp.html"><a href="EM-exp.html"><i class="fa fa-check"></i><b>9.2</b> Exponential families</a></li>
<li class="chapter" data-level="9.3" data-path="fisher-information.html"><a href="fisher-information.html"><i class="fa fa-check"></i><b>9.3</b> Fisher information</a></li>
<li class="chapter" data-level="9.4" data-path="two-examples-revisited.html"><a href="two-examples-revisited.html"><i class="fa fa-check"></i><b>9.4</b> Two examples revisited</a><ul>
<li class="chapter" data-level="9.4.1" data-path="two-examples-revisited.html"><a href="two-examples-revisited.html#gaussian-mixtures-1"><i class="fa fa-check"></i><b>9.4.1</b> Gaussian mixtures</a></li>
<li class="chapter" data-level="9.4.2" data-path="two-examples-revisited.html"><a href="two-examples-revisited.html#gaussian-state-space"><i class="fa fa-check"></i><b>9.4.2</b> Gaussian state space</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="stochastic-optimization.html"><a href="stochastic-optimization.html"><i class="fa fa-check"></i><b>10</b> Stochastic Optimization</a><ul>
<li class="chapter" data-level="10.1" data-path="stochastic-gradient.html"><a href="stochastic-gradient.html"><i class="fa fa-check"></i><b>10.1</b> Stochastic gradient</a></li>
<li class="chapter" data-level="10.2" data-path="stochastic-em.html"><a href="stochastic-em.html"><i class="fa fa-check"></i><b>10.2</b> Stochastic EM</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Statistics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="adaptive" class="section level2">
<h2><span class="header-section-number">4.4</span> Adaptive envelopes</h2>
<p>A good envelope should be tight, meaning that <span class="math inline">\(\alpha\)</span> is close to one, it should be fast to simulate from and have a density that is fast to evaluate. It is not obvious how to find such an envelope for an arbitrary target density <span class="math inline">\(f\)</span>.</p>
<p>This section develops first of all a method for construction of envelopes for all <a href="https://en.wikipedia.org/wiki/Logarithmically_concave_function#Log-concave_distributions">log-concave target densities</a>. This is a special class of densities, but it is not uncommon in practice, and it can be extended to work for some densities that have combinations of log-concave and log-convex behaviors. The same idea used for constructing envelopes can be used to bound <span class="math inline">\(f\)</span> from below. The accept-reject step can then avoid many evaluations of <span class="math inline">\(f\)</span>, which is beneficial if <span class="math inline">\(f\)</span> is computationally expensive to evaluate.</p>
<p>For a continuously differentiable, strictly positive and log-concave target on an open interval <span class="math inline">\(I \subseteq \mathbb{R}\)</span> it holds that <span class="math display">\[\log(f(x)) \leq \frac{f&#39;(x_0)}{f(x_0)}(x - x_0) + \log(f(x_0))\]</span> for any <span class="math inline">\(x, x_0 \in I\)</span>.</p>
<p>Let <span class="math inline">\(x_1 &lt; x_2 &lt; \ldots &lt; x_{m} \in I\)</span> and let <span class="math inline">\(I_1, \ldots, I_m \subseteq I\)</span> be intervals that form a partition of <span class="math inline">\(I\)</span> such that <span class="math inline">\(x_i \in I_i\)</span>. Defining <span class="math display">\[a_i = (\log(f(x_i)))&#39; = \frac{f&#39;(x_i)}{f(x_i)} \quad \text{and} \quad b_i = \log(f(x_i)) -  \alpha_i x_i\]</span> we find the upper bound <span class="math display">\[\log(f(x)) \leq V(x) = \sum_{i=1}^m  (a_i x + b_i) 1_{I_i}(x),\]</span> or <span class="math display">\[f(x) \leq e^{V(x)}.\]</span> Note that by the log-concavity of <span class="math inline">\(f\)</span>, <span class="math inline">\(a_1 \geq a_2 \geq \ldots \geq a_m\)</span>. The upper bound is integrable over <span class="math inline">\(I\)</span> if either <span class="math inline">\(a_1 &gt; 0\)</span> and <span class="math inline">\(a_m &lt; 0\)</span>, or <span class="math inline">\(a_m &lt; 0\)</span> and <span class="math inline">\(I\)</span> is bounded to the left, or <span class="math inline">\(a_1 &gt; 0\)</span> and <span class="math inline">\(I\)</span> is bounded to the right. In any of these cases we define <span class="math display">\[c = \int_I e^{V(x)} \mathrm{d} x &lt; \infty\]</span> and <span class="math inline">\(g(x) = c^{-1} \exp(V(x))\)</span>, and we find that with <span class="math inline">\(\alpha = c^{-1}\)</span> then <span class="math inline">\(\alpha f \leq g\)</span> and <span class="math inline">\(g\)</span> is an envelope of <span class="math inline">\(f\)</span>. Note that it is actually not necessary to compute <span class="math inline">\(c\)</span> (or <span class="math inline">\(\alpha\)</span>) to implement the rejection step in the rejection sampler, but that <span class="math inline">\(c\)</span> is needed for the simulating from <span class="math inline">\(g\)</span> as described below. We will assume in the following that <span class="math inline">\(c &lt; \infty\)</span>.</p>
<p>The intervals <span class="math inline">\(I_i\)</span> have not been specified, and we could, in fact, implement rejection sampling with any choice of intervals fulfilling the conditions above. But in the interest of maximizing <span class="math inline">\(\alpha\)</span> (minimizing <span class="math inline">\(c\)</span>) and thus minimizing the rejection frequency, we should choose <span class="math inline">\(I_i\)</span> so that <span class="math inline">\(a_i x + b_i\)</span> is minimal over <span class="math inline">\(I_i\)</span> among all the affine upper bounds. This will result in the tightest envelope. This means that for <span class="math inline">\(i = 1, \ldots, m - 1\)</span>, <span class="math inline">\(I_i = (z_{i-1}, z_i]\)</span> with <span class="math inline">\(z_i\)</span> the point where <span class="math inline">\(a_i x + b_i\)</span> and <span class="math inline">\(a_{i+1} x + b_{i+1}\)</span> intersect. We find that the solution of <span class="math display">\[a_i x + b_i = a_{i+1} x + b_{i+1}\]</span> is <span class="math display">\[z_i = \frac{b_{i+1} - b_i}{a_i - a_{i+1}}\]</span> provided that <span class="math inline">\(a_{i+1} &gt; a_i\)</span>. The two extremes, <span class="math inline">\(z_0\)</span> and <span class="math inline">\(z_m\)</span>, are chosen as the endpoints of <span class="math inline">\(I\)</span> and may be <span class="math inline">\(- \infty\)</span> and <span class="math inline">\(+ \infty\)</span>, respectively.</p>
<p>One way to simulate from such envelopes is by transformation of uniform random variables by the inverse distribution function. It requires a little bookkeeping, but is otherwise straightforward. Define for <span class="math inline">\(x \in I_i\)</span> <span class="math display">\[F_i(x) = \int_{z_{i-1}}^x e^{a_i z + b_i} \mathrm{d} z,\]</span> and let <span class="math inline">\(R_i = F_i(z_i)\)</span>. Then <span class="math inline">\(c = \sum_{i=1}^m R_i\)</span>, and if we define <span class="math inline">\(Q_i = \sum_{k=1}^{i} R_k\)</span> for <span class="math inline">\(i = 0, \ldots, m\)</span> the inverse of the distribution function in <span class="math inline">\(q\)</span> is given as the solution of the equation <span class="math display">\[F_i(x) = cq - Q_{i-1}, \qquad Q_{i-1} &lt; cq \leq Q_{i}.\]</span> That is, for a given <span class="math inline">\(q \in (0, 1)\)</span>, first determine which interval <span class="math inline">\((Q_{i-1}, Q_{i}]\)</span> that <span class="math inline">\(c q\)</span> falls into, and then solve the corresponding equation. Observe that when <span class="math inline">\(a_i \neq 0\)</span>, <span class="math display">\[F_i(x) = \frac{1}{a_i}e^{b_i}\left(e^{a_i x} - e^{a_i z_{i-1}}\right).\]</span></p>
<div id="beta-distribution" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Beta distribution</h3>
<p>To illustrate the envelope construction above for a simple log-concave density we consider the Beta distribution on <span class="math inline">\((0, 1)\)</span> with shape parameters <span class="math inline">\(\geq 1\)</span>. This distribution has density <span class="math display">\[f(x) \propto x^{\alpha - 1}(1-x)^{\beta - 1},\]</span> which is log-concave (when the shape parameters are greater than one). We implement the rejection sampling algorithm for this density with the adaptive envelope using two points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Betasim &lt;-<span class="st"> </span><span class="cf">function</span>(n, x1, x2, alpha, beta) {
  lf &lt;-<span class="st"> </span><span class="cf">function</span>(x) (alpha <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(x) <span class="op">+</span><span class="st"> </span>(beta <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x) 
  lf_deriv &lt;-<span class="st"> </span><span class="cf">function</span>(x) (alpha <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>x <span class="op">-</span><span class="st"> </span>(beta <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x)
  a1 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x1)
  a2 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x2)
  <span class="cf">if</span>(a1 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>a2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>a1 <span class="op">-</span><span class="st"> </span>a2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) 
    <span class="kw">stop</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">The implementation requires a_1 and a_2 different </span>
<span class="st">and both different from zero. Choose different values of x_1 and x_2.&quot;</span>)
  b1 &lt;-<span class="st"> </span><span class="kw">lf</span>(x1) <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>x1
  b2 &lt;-<span class="st"> </span><span class="kw">lf</span>(x2) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>x2
  z1 &lt;-<span class="st"> </span>(b2 <span class="op">-</span><span class="st"> </span>b1) <span class="op">/</span><span class="st"> </span>(a1 <span class="op">-</span><span class="st"> </span>a2)
  Q1 &lt;-<span class="st"> </span><span class="kw">exp</span>(b1) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z1) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>a1 
  c =<span class="st"> </span>Q1 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b2) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span><span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2

  m &lt;-<span class="st"> </span>n  
  fact &lt;-<span class="st"> </span><span class="dv">1</span>
  j &lt;-<span class="st"> </span><span class="dv">1</span>
  y &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)
  uy &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(m)
  u &lt;-<span class="st"> </span><span class="kw">runif</span>(m)
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {
    <span class="cf">repeat</span> {
      u0 &lt;-<span class="st"> </span>uy[j]
      <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q1) {
        z &lt;-<span class="st"> </span><span class="kw">log</span>(a1 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b1) <span class="op">*</span><span class="st"> </span>u0 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>a1
        ratio &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b1)
      } <span class="cf">else</span> {
        z &lt;-<span class="st"> </span><span class="kw">log</span>(a2 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b2) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q1) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2
        ratio &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b2)
      }
      accept &lt;-<span class="st"> </span>u[j] <span class="op">&lt;=</span><span class="st"> </span>ratio
      j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
      <span class="cf">if</span>(j <span class="op">&gt;</span><span class="st"> </span>m) {
        <span class="cf">if</span>(fact <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) fact &lt;-<span class="st"> </span>n <span class="op">/</span><span class="st"> </span>i
        m &lt;-<span class="st"> </span><span class="kw">floor</span>(fact <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))
        uy &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(m)
        u &lt;-<span class="st"> </span><span class="kw">runif</span>(m)
        j &lt;-<span class="st"> </span><span class="dv">1</span>
      }
      <span class="cf">if</span>(accept) <span class="cf">break</span>
    }
    y[i] &lt;-<span class="st"> </span>z
  }
  y
}</code></pre></div>

<div class="figure" style="text-align: center"><span id="fig:Beta-sim"></span>
<img src="CSwR_files/figure-html/Beta-sim-1.png" alt="Histograms of simulated variables from Beta distributions using the rejection sampler with the adaptive envelope based on log-concavity. The true density (blue) and the envelope (red) are added to the plots." width="100%" />
<p class="caption">
Figure 4.4: Histograms of simulated variables from Beta distributions using the rejection sampler with the adaptive envelope based on log-concavity. The true density (blue) and the envelope (red) are added to the plots.
</p>
</div>
<p>Note that as a safeguard we implemented a test on the <span class="math inline">\(a_i\)</span>s to check that the formulas used are actually meaningful, specifically that there are no divisions by zero.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Betasim</span>(<span class="dv">1</span>, <span class="dt">x1 =</span> <span class="fl">0.25</span>, <span class="dt">x2 =</span> <span class="fl">0.75</span>, <span class="dt">alpha =</span> <span class="dv">4</span>, <span class="dt">beta =</span> <span class="dv">2</span>)  </code></pre></div>
<pre><code>## Error in Betasim(1, x1 = 0.25, x2 = 0.75, alpha = 4, beta = 2): 
## This implementation requires a_1 and a_2 different 
## and both different from zero. Choose different values of x_1 and x_2.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Betasim</span>(<span class="dv">1</span>, <span class="dt">x1 =</span> <span class="fl">0.2</span>, <span class="dt">x2 =</span> <span class="fl">0.75</span>, <span class="dt">alpha =</span> <span class="dv">4</span>, <span class="dt">beta =</span> <span class="dv">2</span>)   </code></pre></div>
<pre><code>## Error in Betasim(1, x1 = 0.2, x2 = 0.75, alpha = 4, beta = 2): 
## This implementation requires a_1 and a_2 different 
## and both different from zero. Choose different values of x_1 and x_2.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Betasim</span>(<span class="dv">1</span>, <span class="dt">x1 =</span> <span class="fl">0.2</span>, <span class="dt">x2 =</span> <span class="fl">0.8</span>, <span class="dt">alpha =</span> <span class="dv">4</span>, <span class="dt">beta =</span> <span class="dv">2</span>)    </code></pre></div>
<pre><code>## [1] 0.7668483</code></pre>
</div>
<div id="von-mises-distribution" class="section level3">
<h3><span class="header-section-number">4.4.2</span> von Mises distribution</h3>
<p>The <a href="reject-samp.html#vMsim">von Mises rejection sampler</a> in Section <a href="reject-samp.html#vMsim">4.3.1</a> used the uniform distribution as proposal distribution. As it turns out, the uniform density is not a particularly tight envelope. We illustrate this by studying the proportion of rejections for our previous implementation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="fl">0.1</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="fl">0.5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="dv">2</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="dv">5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## kappa = 0.1 : 0.0942029 
## kappa = 0.5 : 0.3473011 
## kappa = 2 : 0.6954377 
## kappa = 5 : 0.8172481</code></pre>
<p>The rejection frequency is high and increases with <span class="math inline">\(\kappa\)</span>. For <span class="math inline">\(\kappa = 5\)</span> more than 80% of the proposals are rejected, and simulating <span class="math inline">\(n = 10000\)</span> von Mises distributed variables thus requires the simulation of around <span class="math inline">\(50000\)</span> variables from the proposal.</p>
<p>The von Mises density is, unfortunately, not log-concave on <span class="math inline">\((-\pi, \pi)\)</span>, but it is on <span class="math inline">\((-\pi/2, \pi/2)\)</span>. It is, furthermore, log-convex on <span class="math inline">\((-\pi, -\pi/2)\)</span> as well as <span class="math inline">\((\pi/2, \pi)\)</span>, which implies that on these two intervals the log-density is below the corresponding chords. These chords can be pieced together with tangents to give an envelope.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vMsim_adapt &lt;-<span class="st"> </span><span class="cf">function</span>(n, x1, x2, kappa, <span class="dt">trace =</span> <span class="ot">FALSE</span>) {
  lf &lt;-<span class="st"> </span><span class="cf">function</span>(x) kappa <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(x) 
  lf_deriv &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="op">-</span><span class="st"> </span>kappa <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(x)
  a1 &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>kappa <span class="op">/</span><span class="st"> </span>pi
  a2 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x1)
  a3 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x2)
  a4 &lt;-<span class="st"> </span><span class="op">-</span><span class="st"> </span>a1
  
  b1 &lt;-<span class="st"> </span>kappa
  b2 &lt;-<span class="st"> </span><span class="kw">lf</span>(x1) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>x1
  b3 &lt;-<span class="st"> </span><span class="kw">lf</span>(x2) <span class="op">-</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>x2
  b4 &lt;-<span class="st"> </span>kappa
  
  z0 &lt;-<span class="st"> </span><span class="op">-</span>pi
  z1 &lt;-<span class="st"> </span><span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span>
  z2 &lt;-<span class="st"> </span>(b3 <span class="op">-</span><span class="st"> </span>b2) <span class="op">/</span><span class="st"> </span>(a2 <span class="op">-</span><span class="st"> </span>a3)
  z3 &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span>
  z4 &lt;-<span class="st"> </span>pi
  
  Q1 &lt;-<span class="st"> </span><span class="kw">exp</span>(b1) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z1) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z0)) <span class="op">/</span><span class="st"> </span>a1 
  Q2 &lt;-<span class="st"> </span>Q1 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b2) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z2) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2
  Q3 &lt;-<span class="st"> </span>Q2 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b3) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a3 <span class="op">*</span><span class="st"> </span>z3) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a3 <span class="op">*</span><span class="st"> </span>z2)) <span class="op">/</span><span class="st"> </span>a3
  c =<span class="st"> </span>Q3 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b4) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a4 <span class="op">*</span><span class="st"> </span>z4) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a4 <span class="op">*</span><span class="st"> </span>z3)) <span class="op">/</span><span class="st"> </span>a4
  
  m &lt;-<span class="st"> </span>n  
  fact &lt;-<span class="st"> </span><span class="dv">1</span>
  j &lt;-<span class="st"> </span><span class="dv">1</span>
  count &lt;-<span class="st"> </span><span class="dv">0</span>
  y &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)
  uy &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(m)
  u &lt;-<span class="st"> </span><span class="kw">runif</span>(m)
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {
    <span class="cf">repeat</span> {
      u0 &lt;-<span class="st"> </span>uy[j]
      <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q1) {
        z &lt;-<span class="st"> </span><span class="kw">log</span>(a1 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b1) <span class="op">*</span><span class="st"> </span>u0 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z0)) <span class="op">/</span><span class="st"> </span>a1
        ratio &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b1)
      } <span class="cf">else</span> <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q2) {
        z &lt;-<span class="st"> </span><span class="kw">log</span>(a2 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b2) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q1) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2
        ratio &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b2)
      } <span class="cf">else</span> <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q3) {
        z &lt;-<span class="st"> </span><span class="kw">log</span>(a3 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b3) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q2) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a3 <span class="op">*</span><span class="st"> </span>z2)) <span class="op">/</span><span class="st"> </span>a3
        ratio &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b3)
      } <span class="cf">else</span> {
        z &lt;-<span class="st"> </span><span class="kw">log</span>(a4 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b4) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q3) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a4 <span class="op">*</span><span class="st"> </span>z3)) <span class="op">/</span><span class="st"> </span>a4
        ratio &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b4)
      }
      accept &lt;-<span class="st"> </span>u[j] <span class="op">&lt;=</span><span class="st"> </span>ratio
      j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
      count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
      <span class="cf">if</span>(j <span class="op">&gt;</span><span class="st"> </span>m) {
        <span class="cf">if</span>(fact <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) fact &lt;-<span class="st"> </span>n <span class="op">/</span><span class="st"> </span>i
        m &lt;-<span class="st"> </span><span class="kw">floor</span>(fact <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))
        uy &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(m)
        u &lt;-<span class="st"> </span><span class="kw">runif</span>(m)
        j &lt;-<span class="st"> </span><span class="dv">1</span>
      }
      <span class="cf">if</span>(accept) <span class="cf">break</span>
    }
    y[i] &lt;-<span class="st"> </span>z
  }
  <span class="cf">if</span>(trace)
    <span class="kw">cat</span>(<span class="st">&quot;kappa =&quot;</span>, kappa, <span class="st">&quot;, x1 =&quot;</span>, x1, <span class="st">&quot;, x2 =&quot;</span>, x2, <span class="st">&quot;:&quot;</span>, (count <span class="op">-</span><span class="st"> </span>n) <span class="op">/</span><span class="st"> </span>count, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)  
  y
}</code></pre></div>

<div class="figure" style="text-align: center"><span id="fig:vM-adaptive-test"></span>
<img src="CSwR_files/figure-html/vM-adaptive-test-1.png" alt="Something." width="100%" />
<p class="caption">
Figure 4.5: Something.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="dv">5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="dv">2</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## kappa = 5 , x1 = -0.4 , x2 = 0.4 : 0.2027489 
## kappa = 2 , x1 = -1 , x2 = 1 : 0.2420568 
## kappa = 5 , x1 = -0.1 , x2 = 0.1 : 0.4843022 
## kappa = 2 , x1 = -0.4 , x2 = 0.4 : 0.1559472</code></pre>
<p>We see that compared to using the uniform density as envelope, these adaptive envelopes are generally tighter and leads to fewer rejections. Even tighter envelopes are possible by using more than four intervals, but it is, of course, always a good question how the added complexity and bookkeeping induced by using more advanced and adaptive envelopes affect run time. It is even a good question if our current adaptive implementation will outperform our first, and much simpler, implementation that used the uniform envelope.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">microbenchmark</span>(<span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>),
               <span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="dv">5</span>),
               <span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="dv">5</span>),
               <span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">5</span>),
               <span class="kw">vMsim</span>(<span class="dv">100</span>, <span class="dv">5</span>)
               )</code></pre></div>
<pre><code>## Unit: microseconds
##                            expr min  lq mean median  uq   max neval
##      vMsim_adapt(100, -1, 1, 5) 285 347  376    367 397   570   100
##  vMsim_adapt(100, -0.4, 0.4, 5) 158 171  184    179 189   386   100
##  vMsim_adapt(100, -0.2, 0.2, 5) 182 207  221    219 230   300   100
##  vMsim_adapt(100, -0.1, 0.1, 5) 214 253  272    267 283   388   100
##                   vMsim(100, 5) 137 170  403    179 196 22259   100</code></pre>
<p>The results from the benchmark show that the adaptive implementation has run time comparable to using the uniform proposal. With <span class="math inline">\(x_1 = -0.4\)</span> and <span class="math inline">\(x_2 = 0.4\)</span> and <span class="math inline">\(\kappa = 5\)</span> we found above that the rejection frequency was about 20% with the adaptive envelope, while it was about 80% when using the uniform envelope. A naive computation would thus suggest a speedup of a factor 4, but there is no actual speedup.</p>
<p>Even if either implementation can be improved further in terms of run time, it is an important point when comparing algorithms that we dont get too focused on surrogate performance quantities. The probability of rejection is a surrogate for actual run time, and it might be conceptually of interest to bring this probability down. But if it is at the expense of additional computations it might not be worth the effort in terms of real run time.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reject-samp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercises-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
